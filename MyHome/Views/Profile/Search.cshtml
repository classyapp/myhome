@model Classy.DotNet.Mvc.ViewModels.Profiles.SearchViewModel<MyHome.Models.ProfessionalMetadata>

@{
    ViewBag.Title = "SearchProfiles";
    var categories = Localizer.GetList("professional-categories");
}

<div class="row">
    <div class="sidebar col-md-2">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">@Localizer.Get("SearchProfiles_Title_Results")</h3>
            </div>
            <div class="panel-body" itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
                @if (!string.IsNullOrEmpty(Model.Category))
                {
                    <span class="label label-default">
                        <a itemscope itemprop="url" href="@Url.RouteUrlForCurrentLocale("SearchProfiles", new { category = Model.Category })">@categories.Single(x => x.Value == Model.Category).Text</a>
                        <a class="dismiss" href="@Url.RouteUrlForCurrentLocale("SearchProfiles", new { })">x</a>
                    </span>
                }
                <br />
                @if (Model.Location != null)
                {
                    <span class="tag">
                        <a itemscope itemprop="url" href="@Url.RouteUrlForCurrentLocale("SearchProfiles", new { category = Model.Category, location = Model.Location })">@Model.Location</a>
                        <a class="dismiss" href="@Url.RouteUrlForCurrentLocale("SearchProfiles", new { category = Model.Category })">x</a>
                    </span>
                }
                </div>
            </div>

        <div class="panel panel-default">
            <div class="panel-heading">
                <h3 class="panel-title">@Localizer.Get("SearchProfiles_Sidebar_Categories")</h3>
            </div>
            <div class="panel-body panel-links">
                @foreach(var c in categories)
                {
                    @Html.RouteLinkForCurrentLocale(c.Text, "SearchProfiles", new { category = c.Value })
                }
            </div>
        </div>
    </div>

    <div class="main col-md-10">
        @if (Model.Category != null) {
            <h1>@categories.Single(x => x.Value == Model.Category).Text</h1>
        }
        else {
            <h1>@Localizer.Get("ProfileSearch_ResultsHeader_AllPros")</h1>
        }
        <hr/>

        <div class="search-form">
            @using (var f = Html.Bootstrap().Begin(new Form("Search", "Profile").Type(FormType.Inline).FormMethod(FormMethod.Post)))
            {
                @f.FormGroup().TextBoxFor(x => x.Name).Placeholder(Localizer.Get("SearchProfiles_Label_Name")).Label().Class("sr-only")
                @f.FormGroup().TextBoxFor(x => x.Location).Placeholder(Localizer.Get("SearchProfiles_Label_City")).Label().Class("sr-only")
                @f.FormGroup().DropDownListFor(x => x.Category, categories.AsSelectList()).OptionLabel(Localizer.Get("SearchProfiles_Label_CategoryDefaultOption")).Label().Class("sr-only")

                @Html.Bootstrap().SubmitButton().Text(Localizer.Get("SearchProfiles_Label_Submit")).Style(ButtonStyle.Success)
            }
        </div>

        @if (Model.Results != null)
        {
            <div class="row results">
            @foreach (var p in Model.Results)
            {
                <div class="col-md-4">
                    <div class="profile">
                        <div class="media">
                            <a class="pull-left" href="#">
                                <img class="media-object" src="@p.ThumbnailUrl" />
                            </a>
                            <div class="media-body">
                                <h4 class="media-heading">@Html.ProfileLink(p)</h4>
                                @if (p.ReviewCount > 0)
                                {
                                    <span class="stars">
                                        @for (var i = 1; i <= Convert.ToInt16(Math.Round(p.ReviewAverageScore, 0)); i++)
                                        {
                                            <span class="glyphicon glyphicon-star"></span>
                                        }
                                        @for (var i = 1; i <= 5 - Convert.ToInt16(Math.Round(p.ReviewAverageScore, 0)); i++)
                                        {
                                            <span class="glyphicon glyphicon-star-empty"></span>
                                        }
                                    </span>
                                }
                                    
                                @if (p.ProfessionalInfo.CompanyContactInfo != null &&
                                p.ProfessionalInfo.CompanyContactInfo.Location != null &&
                                p.ProfessionalInfo.CompanyContactInfo.Location.Address != null)
                                    {
                                        <div class="contact-info">
                                            <span>@p.ProfessionalInfo.CompanyContactInfo.Location.Address.City</span>, @p.ProfessionalInfo.CompanyContactInfo.Location.Address.Country
                                        </div>
                                    }
                                        
                                @if (p.Metadata.ContainsKey("BusinessDescription"))
                                {
                                    <p>
                                        @p.Metadata["BusinessDescription"]
                                    </p>
                                }
                            </div>
                        </div>
                    </div>
                </div>
                
            }
            </div>
        }
    </div>
</div>
