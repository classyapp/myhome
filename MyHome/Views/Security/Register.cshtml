@model Classy.DotNet.Mvc.ViewModels.Security.RegistrationViewModel<MyHome.Models.UserMetadata>

@{
    ViewBag.Title = "Register";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="text-center">
    <h2>@Localizer.Get("Login_Welcome")</h2>
</div>

<div class="row">
    <div class="col-md-4 col-md-offset-4">
        <div class="register">
            <div class="fb text-center">
                <a id="sign-in-facebook" class="btn btn-block btn-lg btn-fb-login" href="#" role="button">@Localizer.Get("Login_Facebook")</a>
            </div>

            <p class="text-center">@Localizer.Get("Register_OrSignUpWithEmail")</p>

            @Html.Bootstrap().ValidationSummary()
            @using (var f = Html.Bootstrap().Begin(new Form("Register").FormMethod(FormMethod.Post).Id("mainForm")))
            {
                @f.FormGroup().TextBoxFor(x => x.Email).ShowValidationMessage(false).Label().WidthLg(12).ShowRequiredStar(false)
                @f.FormGroup().TextBoxFor(x => x.Username).ShowValidationMessage(false).Label().WidthLg(12).ShowRequiredStar(false)
                @f.FormGroup().PasswordFor(x => x.Password).ShowValidationMessage(false).Label().WidthLg(12).ShowRequiredStar(false)

                @Html.Bootstrap().RadioButtonFor(x => x.Metadata.IsRenter, false).Label().ShowRequiredStar(false)
                @Html.Bootstrap().RadioButtonFor(x => x.Metadata.IsHomeOwner, false).Label().ShowRequiredStar(false)
                @Html.Bootstrap().RadioButtonFor(x => x.Metadata.IsCommercial, false).Label().ShowRequiredStar(false);
                @Html.Bootstrap().RadioButtonFor(x => x.IsProfessional, false).Label().ShowRequiredStar(false)

                @Html.Bootstrap().SubmitButton().Class("btn-block btn-success").Text(Localizer.Get("Register_Submit"))
            }
        </div>
    </div>
</div>

@using (var modal = Html.Bootstrap().Begin(new Modal().Id("more-details")))
{
    using (modal.BeginHeader())
    {
        <h4 class="modal-title">#</h4>
    }

    using (Html.Bootstrap().Begin(new Form("CompleteRegistration").FormMethod(FormMethod.Post).Id("modalForm")))
    {
        using (modal.BeginBody())
        {
            @Html.Bootstrap().RadioButtonFor(x => x.Metadata.IsRenter, false).Label().ShowRequiredStar(false);
            @Html.Bootstrap().RadioButtonFor(x => x.Metadata.IsHomeOwner, true).Label().ShowRequiredStar(false);
            @Html.Bootstrap().RadioButtonFor(x => x.Metadata.IsCommercial, true).Label().ShowRequiredStar(false);
            @Html.Bootstrap().RadioButtonFor(x => x.IsProfessional, true).Label().ShowRequiredStar(false);

            @Html.Bootstrap().SubmitButton().Text(Localizer.Get("Register_ContinueToSite")).Style(ButtonStyle.Success);
        }
    }
}

@section scripts {
    @Scripts.Render("~/scripts/fb-login.js")
    <script>


        $(function () {
            // faux radio group
            $('input[type=radio]').click(function () {
                var id = this.id;
                $('input[type=radio]').each(function (idx, item) {
                    if (item.id != id) $(item).prop('checked', false);
                })
            });

            // disable validation on the stupid radio buttons
            $.data($('#mainForm')[0], 'validator').settings.ignore = "input[type=radio]";
            $.data($('#modalForm')[0], 'validator').settings.ignore = "input[type=radio]";

            // bind validation summary
            $("#mainForm").bind('invalid-form.validate', function (form, validator) {
                var $list = $('.validation-summary-valid ul:first')
                if ($list.length && validator.errorList.length) {
                    $list.empty();
                    $.each(validator.errorList, function () {
                        $("<li />").html(this.message).appendTo($list);
                    });
                }
            });
        });

        OnFacebookLogin = function (profile) {
            $('h4.modal-title').html('@Localizer.Get("Register_Hello") ' + profile.ContactInfo.Name);
            $('#more-details').modal({
                keyboard: false,
                backdrop: 'static'
            });
        }
    </script>
}



